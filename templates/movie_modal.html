{% load staticfiles %}
<link rel="stylesheet" href="{% static 'css/style.css' %}">
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.5/css/select2.css" rel="stylesheet" />
<div class="movie-data">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        {% if data_id %}
            <h4 class="modal-title">Edit Movie Details</h4>
        {% else %}
            <h4 class="modal-title">Add New Movie Details</h4>
        {% endif %}
    </div>

    <div class="modal-body">
        <form method="POST" action="{% url 'api:movie-save' %}" id="MovieSaveForm">
            {% csrf_token %}
            <p class="bs-component">
                <input class="form-control" type="text" name="movie_name"
                       placeholder="Enter Movie name" value="{{ movie_data.name }}" required>
            </p>
            <p class="bs-component">
                <select class="form-control" name="genre" id="genrelist" multiple>
                    {% for gen in genre %}
                        <option value="{{ gen.id }}" {% if gen.id in selected_genre %} selected{% endif %}>{{ gen.name }}</option>
                    {% endfor %}
                </select>
            </p>
            <p class="bs-component">
                <input class="form-control" type="text" name="director_name" required
                       placeholder="Enter Director name such as George Lucas, Joss Whedon, etc"
                       value="{{ movie_data.director }}">
            </p>
            <p class="bs-component">
                <input class="form-control" type="number" step="0.01" name="popularity" min="1.0"
                       placeholder="Enter popularity in Decimal such as 70.0" value="{{ movie_data.popularity }}">
            </p>
            <p class="bs-component">
                <input class="form-control" type="number" step="0.01" name="imdb_score" min="1.0"
                       placeholder="Enter IMDB Score in Decimal such as 7.0" value="{{ movie_data.score }}">
            </p>
            <p class="bs-component">
                <input class="form-control" type="hidden" name="movie_id" value="{{ movie_data.id }}">
            </p>
            <div id="error" style="color: red;"></div>
            <div id="success" style="color: green;"></div>
            <div class="modal-footer">
                <button type="submit" id="search-button">Save</button>
            </div>
        </form>
    </div>
</div>

<script src="//code.jquery.com/jquery-3.3.1.min.js"></script>
<script>
    $("#MovieSaveForm").on("submit", function () {
        var form = $(this);
        var url = form.attr('action');
        $.ajax({
            url: url,
            type: "POST",
            data: form.serialize(),
            success: function (response) {
                if (response.success) {
                    form.find("#success").html("Successfully Saved changes");
                    location.reload();
                } else {
                    form.find("#error").html(response["message"]);
                }
            },
            error: function () {
                alert("Something Went wrong");
            }
        });
        return false;
    })
</script>
